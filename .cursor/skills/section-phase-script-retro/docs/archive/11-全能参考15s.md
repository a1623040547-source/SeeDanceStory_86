# 十一、全能参考视频上传（平台 15s 限制）（section03 中期复盘）

### 问题简述

- 在平台上使用**全能参考**上传视频时，**不能只传上一段视频**：需要同时提供「整体环境/风格」与「下一段连续性」两类参考。
- 平台参考视频总时长限制为 **15 秒**以内；做法是拆成**两个独立视频**（一个 7s、一个 8s），**分别**上传/使用，**不要**把 7s 和 8s 拼成一条 15s 再传。

### 正确做法

1. **两个独立视频，不拼接**
   - **7s 视频**（`ref_env_7s.mp4`）：从 **section 第一段（phase01）视频**中截取**前 7 秒**。  
     - 用途：**整体环境/风格参考**（与「第一段环境氛围参考图」一致：打光、场景、色调、氛围），供下一段生成时锁定与段 1 一致的整体观感。  
   - **8s 视频**（`ref_continuity_8s.mp4`）：从**当前最新 phase**（即刚完成的那一段）视频中截取**后 8 秒**。  
     - 用途：**下一段需要生成视频的连续性参考**（V2V 衔接、动作/状态接续）。
   - 使用时：**分别**上传或分别选为「环境参考」与「连续性参考」，不要合并成一条 15s 视频。

2. **特殊情形**  
   - 若**第一段即为最新**（即当前只有 phase01 有视频），则 7s 与 8s 均从该段截取（前 7s 一份、后 8s 一份），仍是两个文件。

### 全能参考首段提示词（上传时填写）

每次上传全能参考时，可沿用下面四行作为各参考槽的说明文案（复制到平台对应位置）：

```
为人物参考 ｜
为故事发生环境参考（环境需要适配人物画风）｜
为上一段视频尾帧参考，如果没有切换镜头过渡的话，需要用在这一段首帧｜
为第一段视频参考，让这一段视频与第一段画面风格保持一致
```

- 第 1 行：人物参考
- 第 2 行：故事发生环境参考（环境需适配人物画风）
- 第 3 行：上一段视频尾帧参考（无镜头过渡时用于本段首帧）
- 第 4 行：第一段视频参考（保持与第一段画面风格一致）

### 使用脚本

脚本位置：`.cursor/skills/section-phase-script-retro/scripts/build_ref_15s.py`  
依赖：**ffmpeg**。

脚本会生成**两个文件**，均放在 `{section}/phases/` 下：

- `ref_env_7s.mp4` — 第一段前 7s（环境/风格）
- `ref_continuity_8s.mp4` — 最新段后 8s（连续性）

```bash
# 在项目根目录执行
# 为 section03 生成 7s + 8s 两个视频，输出到 section03/phases/
python3 .cursor/skills/section-phase-script-retro/scripts/build_ref_15s.py --section section03

# 指定项目根
python3 .cursor/skills/section-phase-script-retro/scripts/build_ref_15s.py --section section03 --project-root /path/to/proj
```

| 参数 | 说明 | 默认 |
|------|------|------|
| `--section NAME` | section 目录名，如 section03 | 必填 |
| `--project-root PATH` | 项目根目录（其下有 section02、section03 等） | 自动推断 |

- 脚本自动查找该 section 下**有视频的**最小 phase（第一段）与最大 phase（最新段）。
- **一般**：7s = 第一段视频前 7s，8s = 最新段视频后 8s，输出为两个独立 mp4。
- **仅第一段有视频时**：从该段截取前 7s 写入 `ref_env_7s.mp4`，后 8s 写入 `ref_continuity_8s.mp4`。

### 小结

| 输出文件 | 来源 | 时长 | 作用 |
|----------|------|------|------|
| ref_env_7s.mp4 | section 第一段视频 | 前 7s | 整体环境/风格参考 |
| ref_continuity_8s.mp4 | 最新 phase 视频 | 后 8s | 下一段生成的连续性参考 |

**注意**：是**两个独立视频**，分别上传或分别选用，不要拼成一条 15s。

### 自检清单（全能参考上传）

- [ ] 是否已用脚本或手动截取得到**两个文件**：7s 环境参考 + 8s 连续性参考，且**没有**把两者拼成一条 15s 视频。
- [ ] 00 或操作流程中是否注明「全能参考为两个独立视频（7s + 8s），分别上传/使用」。
