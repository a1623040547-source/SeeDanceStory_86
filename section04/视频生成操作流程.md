# 《86｜不存在的日常》夏日海边 视频生成操作流程

> **【废案】** 本 section 及本流程已标记为废案，详见 [废案说明.md](废案说明.md)。以下内容仅作参考保留。
>
> **通用约定**：生成的**图片与视频比例均为 16:9（长:宽）**。**生图**与**生视频**是**分开的步骤**；生图提示词（首帧/尾帧）放在 phase 目录下的**单独文件**（`phaseXX_img_first.txt`、`phaseXX_img_last.txt`），生视频提示词在 `phaseXX.txt` 内。所有生成素材与提示词均归入**对应 phase 目录**。**首帧与尾帧须根据故事情节而定**：须把该时刻的故事情节写进生图提示词（如首帧写刚到、站定、刚开口的那一瞬，尾帧写段尾定格与下一段衔接的瞬间），而不是只写静态画面。
>
> 本 section 可选用 **即梦（火山引擎）** 或 **Seedance 2.0 API**。即梦：段 1 可用 `scripts/jimeng_volc_phase01.py`（生图→生视频，提示词从 phase 文件读取）；Seedance 见下文。  
> **Seedance 限制**：提示词最大 2000 字；每段仅 1 张参考图，须为公网 URL；`.env` 需 `SEEDANCE_API_KEY`、`IMGBB_API_KEY`，参考图用 `scripts/upload-image-url.sh` 上传。

---

## 〇、生成前必读

| 步骤 | 内容 |
|:----:|------|
| 1 | 阅读 `00-项目总述与素材说明.md`，确认总述、素材类型（首图/尾帧）、**仅 1 张图** 的 API 约束。 |
| 2 | **生图**：首帧/尾帧提示词须**把该时刻的故事情节写进正文**（与 `phaseXX.txt` 情节、分块、衔接一致），例如首帧写「刚到、站定、刚开口的那一瞬」，尾帧写「段尾定格、与下一段衔接的瞬间」。 |
| 3 | 确认 `.env` 中已配置 `SEEDANCE_API_KEY` 与 `IMGBB_API_KEY`（ImgBB 用于上传图片得 URL）。 |
| 4 | 每段提示词从对应 `phases/phaseXX/phaseXX.txt` 取用，**整段复制时注意不超过 2000 字**。 |

---

## 一、前期准备

| 步骤 | 内容 |
|:----:|------|
| 1 | **首图**：制作或选取「夏日海边 + 辛恩与蕾娜度假服、86 画风」的首图，放入 `refs/scenes/`，命名如 `section04_scene_01.png` 或 `section04_ref_img.jpg`（见 refs/scenes/README 命名规范）。 |
| 2 | **上传首图得 URL**：在项目根目录执行 `./scripts/upload-image-url.sh section04/refs/scenes/section04_scene_01.png`（或实际使用的文件名），终端会输出公网 URL，复制保存。 |
| 3 | **角色**：复用 section03/refs/characters；若首图未含两人，可合成后再上传（API 仅 1 图，首图建议含场景+两人）。 |

**若使用合成图（composite）**：运行 `scripts/composite_refs.py` 会得到 2×2 拼图（3 张人物 + 1 张环境）。该图是**参考图**，供 Seedance 理解画风/角色/场景，**不能直接用作首帧**；段 2 的 V2V 必须用段 1 生成视频的**最后一帧**（tail_01）截取并上传的 URL，不能用合成图。

---

## 二、段 1：图 + 文生视频（API）

**段 1 工作流程（顺序不可颠倒）**：① 生图首帧（无现成视频可截，故必须生图）→ ② 用首帧 + 生视频提示词生成本段视频 → ③ **本段视频生成后**，从该视频最后一帧截取得到尾帧。段 1 的尾帧不是「一开始」就存在的，必须做完 ② 才有可截取的视频。

| 步骤 | 操作 |
|:----:|------|
| 1 | **生图首帧**：按 `phase01_img_first.txt` 生图（即梦可用 `jimeng_volc_phase01.py` 或先单独跑 `jimeng_volc_img.py`），得到首帧图；上传得 URL 或保留 base64。 |
| 2 | 调用 API：`prompt` = phase01 中【给即梦/Seedance 生视频的整份提示词】，`image_urls` = `[首图URL]`（或即梦传 base64），`duration` = `"12"`，`aspect_ratio` = `"16:9"`。 |
| 3 | 轮询直至完成，下载视频，保存为 `phases/phase01/phase01.mp4`。 |
| 4 | **截取尾帧**：从**刚生成的**本段视频最后一帧截取，保存为 `section04_tail_01.png`（此时才有段 1 尾帧）。 |
| 5 | **上传尾帧得 URL**：`./scripts/upload-image-url.sh .../section04_tail_01.png`，复制 URL 供段 2 使用。 |

---

## 三、段 2～8：V2V 接力（API）

每段均用「**上一段尾帧图的 URL** + 本段提示词」调用同一 `POST /v1/generate`，即 image-to-video 模式。

| 步骤 | 操作 |
|:----:|------|
| 1 | 使用**上一段尾帧**的公网 URL 作为 `image_urls[0]`（段 2 用 tail_01 的 URL，段 3 用 tail_02，…，段 8 用 tail_07）。 |
| 2 | `prompt` = 当前段 phase 文件中整份提示词（≤2000 字），`duration` = `"12"`。 |
| 3 | 请求成功后轮询 status，下载视频，保存到对应 phase 目录。 |
| 4 | 除段 8 外，从本段视频截取**最后一帧** → `section04_tail_XX.png`，再执行 `upload-image-url.sh` 取得 URL，供下一段使用。 |

**循环**：对段 2～8 重复「尾帧 URL + 本段提示词 → 生成 → 下载 → 截尾帧 → 上传得 URL」。

---

## 四、导出与剪辑

按 README「五、剪辑总时间轴」将 8 段视频首尾相接，总长约 1 分 36 秒；对齐配音后导出成片。

---

## 五、API 与 .env 参考

- **API 文档**：https://seedanceapi.org/docs  
- **.env 示例**（勿提交到 git）：
  ```bash
  SEEDANCE_API_KEY=你的API密钥
  IMGBB_API_KEY=你的ImgBB密钥
  ```
- **提示词**：最大 2000 字符；**image_urls** 最多 1 张，须为公网可访问 URL。  
- **时长**：API 支持 "4"、"8"、"12" 秒，本 section 使用 **12** 秒。

详细调用方式与脚本见项目内 **《seedance-api》Skill**。
